# API - Shopping Site

Base URL: `https://api.shopping.site/v1/` 

## Generic Responses 

### Success 

```json
{
    "status": "success",
    "code": 200,
    "message": "Success message",
    "data": {},
    "meta": {
        "page": 1,
        "limit": 10,
        "total": 100
    }
}
```

### Errors

```json
{
    "status": "error",
    "code": 400,
    "message": "Bad Request",
    "data": {},
    "meta": {}
}
```

## Authentication 

**Header**

```
Authorization: Token <token>
```

## Endpoints

### User 

#### `POST /users` - signup / register a new user 

#### `POST /users/login` - login a user 

#### `POST /users/logout` ğŸ” - logout a user

#### `GET /users/{user_id/user_email}` ğŸ” - get user details

#### `PATCH /users/me` ğŸ” - update user details


### Address

#### `GET /users/me/addresses` ğŸ” - list all addresses

#### `POST /users/me/addresses` ğŸ” - add a new address

#### `PATCH /users/me/addresses/{address_id}` ğŸ” - update an address

#### `DELETE /users/me/addresses/{address_id}` ğŸ” - delete an address

### Product 

#### `POST /products` ğŸ”ğŸ‘®â€â™€ï¸ - add a new product

#### `PATCH /products/{product_id}` ğŸ”ğŸ‘®â€â™€ï¸ - update a product

#### `GET /products` - list all products
- `?vendor_id=123` - filter by vendor
- `?search=keyword` - search by name
- `?min_price=100&max_price=200` - filter by price

#### `GET /products/{group_id/product_id}` - get details of a product

Variant A: Only search by `group_id`
- if only one product of groupid exists
  - `[{title, price, ...}]`
- if multiple products of groupid exists
  - `[{title, price, ...}, {title, price, ...}, {title, price, ...}]`

Variant B: Only search by `group_id`
- if only one product of groupid exists
  - `{title, price, ...}`
- if multiple products of groupid exists
  - `{title, price, ..., variants: [{color}, {color}, {color}]}`

Variant C: Only search by `product_id`
- in all cases - similar response (`grouped_products` empty for single product)
    ```
    {
        title,
        price,
        color
        ...
        grouped_products: [
            {title, price, color, ...},
            {title, price, color, ...},
        ]
    }
    ```

### Cart 

#### `GET /cart` ğŸ” - list all products in cart

#### `PUT /cart/{product_id}` ğŸ” - add product to cart
 - `?buy_now=true` - will create temp cart to turn into order immediately
 - body : `{quantity}`

#### `PATCH /cart/{product_id}` ğŸ” - update product in cart
 - body : `{quantity_incr: }`
 - body : `{quantity_decr: }`
 - > NOTE: We can use `PUT` with absolute quantity and remove this endpoint

#### `DELETE /cart/{product_id}` ğŸ” - remove product from cart

#### `DELETE /cart` ğŸ” - clear all products from cart

### Vendor Orders 

#### `GET /vendor_orders` ğŸ” - list all orders for vendor

#### `GET /vendor_orders/{order_id}` ğŸ” - get details of an order

### Order 

#### `POST /orders` ğŸ” - create a new order with existing cart
 - body : `{billing_address_id, shipping_address_id}`
 - body + `{cart_id}` if multiple carts/user is allowed

#### `GET /orders` ğŸ” - list all orders
- `?sort=created_desc` - filter by created date

#### `GET /orders/{order_id}` ğŸ” - get details of an order

#### `PATCH /orders/{order_id}` ğŸ” - cancel an order
 - body : `{status: "cancelled"}`    


### Payment

#### `GET /orders/{order_id}/payments/{payment_id}` ğŸ” - get payment status

#### `PATCH /orders/{order_id}/payments/{payment_id}` ğŸ” - update payment status
 - body : `{pg_txn_id: "....", status: "success"}`



## Notes 

## REST API Principles 

- "users", "products" 
  - entities / resources 
  - used as "nouns"
  - part of the URL path 

- "create", "update", "delete"
  - actions 
  - used as "verbs"
  - part of the HTTP method


### HTTP Methods 

- GET               fetch/find/search
- POST              create/submit 
- PUT               create/replace       
- DELETE            remove/delete
- PATCH             update/modify
- OPTIONS           get supported methods
- HEAD              get headers only / connectivity testing

### Idempotent Methods 

- GET
- PUT
- DELETE

### POST / PUT - differences in creating 

- `POST /products` 
  - create a new product
  - new entity id is generated by the server
- `PUT /products/123` 
  - create a new product with id 123
  - client is specifying the id

### PUT / PATCH - differences in updating

CASE A:
    Product ID: 123
    `{a: 10, b: 20}`

CASE B:
    Product ID: 123
    `does not exist`

- `PUT /products/123` 
  - body: `{b: 30, c: 40}`
  - replace the product with id 123 or create it
  - client is sending the complete entity
  - CASE A: `{b: 30, c: 40}`
  - CASE B: `{b: 30, c: 40}`

- `PATCH /products/123`
  - body: `{b: 30, c: 40}`
  - update the product with id 123
  - client can send partial entity
  - CASE A: `{a: 10, b: 30, c: 40}`
  - CASE B: `404 : product with id 123 does not exist`

- Using `PATCH` for delta operations 
  - `PATCH /products/123` 
    ```
    {
        "quantity": { "add": 10 }
    }
    ```
